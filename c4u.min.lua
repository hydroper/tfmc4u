-- C4U
_G.c4u={internals={}}do local function a(b,c)for d,e in ipairs(b)do if c==e then return d end end;return-1 end;local f={}local function g(h)if h==nil then h='#'end;local i=f[h]if i==nil then i={}f[h]=i end;local j,k,l=1,1,#i;while k<=l do if j<i[k]then table.insert(i,k,j)return j end;j=i[k]+1;k=k+1 end;i[l+1]=j;return j end;local function m(h,n)if h==nil then h='#'end;local i=f[h]if i==nil then return end;local k=a(n)if k~=-1 then table.remove(i,k)if#i==0 then f[h]=nil end end end;function c4u.internals.playerLeft(o)f[o]=nil end;c4u.component={}function c4u.component.subtype()local p={}function p:typeOf()return self._typeOf end;function p:target()return self._target end;function p:setTarget(c)if self:isRendered()then error('Illegal target reassignment on rendered component')end;self._target=c~=nil and tostring(c)or nil;return self end;function p:parent()return self._parent end;function p:children()return self._children and{table.unpack(self._children)}or{}end;function p:addChild(q)self._children=self._children or{}table.insert(self._children,q)q._parent=self;return self end;function p:removeChild(q)if self._children==nil then return false end;for d,c in ipairs(self._children)do if c==q then table.remove(self._children,d)q._parent=nil;return true end end;return false end;function p:setPos(r,s)self._x=tonumber(r)self._y=tonumber(s)return self end;function p:x()return self._x end;function p:setX(c)self._x=tonumber(c)return self end;function p:y()return self._y end;function p:setY(c)self._y=tonumber(c)return self end;function p:globalX()local t=self._parent;if t==nil then return self._x end;return t:globalX()+self._x end;function p:globalY()local t=self._parent;if t==nil then return self._y end;return t:globalY()+self._y end;function p:fixedPos()return self._fixedPos end;function p:setFixedPos(c)self._fixedPos=not not c;return self end;function p:isRendered()return false end;function p:render()self:renderChildren()end;function p:renderChildren()if self._children==nil then return end;for d,c in ipairs(self._children)do c:render()end end;function p:unrender()self:unrenderChildren()end;function p:unrenderChildren()if self._children==nil then return end;for d,c in ipairs(self._children)do c:unrender()end end;function p:inheritTarget()local u=self._parent;if u~=nil then return u:inheritTarget()end;return self._target end;function p:inheritFixedPos()local u=self._parent;if u~=nil then return u:inheritFixedPos()end;return self._fixedPos end;return setmetatable(p,{__call=function(v,...)return p:new(...)end})end;function c4u.component.subtype_instance(w)return setmetatable({_typeOf=w,_children=nil,_target=nil,_fixedPos=false,_x=0,_y=0},{__index=w})end;c4u.textarea=c4u.component.subtype()local x=c4u.textarea;function x:new()local p=c4u.component.subtype_instance(self)p._renderedId=-1;p._text=''p._width=0;p._height=0;p._backgroundColor=0x324650;p._borderColor=0;p._backgroundAlpha=1;return p end;function x:isRendered()return self._renderedId~=-1 end;function x:text()return self._text end;function x:setText(c)self._text=tostring(c)return self end;function x:setSize(y,z)self._width=tonumber(y)self._height=tonumber(z)return self end;function x:width()return self._width end;function x:setWidth(c)self._width=tonumber(c)return self end;function x:height()return self._height end;function x:setHeight(c)self._height=tonumber(c)return self end;function x:backgroundColor()return self._backgroundColor end;function x:setBackgroundColor(c)self._backgroundColor=tonumber(c)return self end;function x:borderColor()return self._borderColor end;function x:setBorderColor(c)self._borderColor=tonumber(c)return self end;function x:backgroundAlpha()return self._backgroundAlpha end;function x:setBackgroundAlpha(c)self._backgroundAlpha=tonumber(c)return self end;function x:updateRenderedText()if self:isRendered()then ui.updateTextArea(self._renderedId,self._text,self:inheritTarget())end end;function x:render()if self:isRendered()then self:unrender()end;local h=self:inheritTarget()self._renderedId=g(h)local u=self._parent;ui.addTextArea(self._renderedId,self._text,h,self:globalX(),self:globalY(),self._width,self._height,self._backgroundColor,self._borderColor,self._backgroundAlpha,self:inheritFixedPos())self:renderChildren()end;function x:unrender()if not self:isRendered()then return end;local h=self:inheritTarget()ui.removeTextArea(self._renderedId,h)m(h,self._renderedId)self._renderedId=-1;self:unrenderChildren()end;c4u.image=c4u.component.subtype()local A=c4u.image;function A:new()local p=c4u.component.subtype_instance(self)p._renderedId=-1;p._source=''p._scaleX=1;p._scaleY=1;p._angle=0;p._alpha=1;p._anchorX=0;p._anchorY=0;return p end;function A:isRendered()return self._renderedId~=-1 end;function A:source()return self._source end;function A:setSource(c)self._source=c;return self end;function A:scaleX()return self._scaleX end;function A:setScaleX(c)self._scaleX=tonumber(c)return self end;function A:scaleY()return self._scaleY end;function A:setScaleY(c)self._scaleY=tonumber(c)return self end;function A:angle()return self._angle end;function A:setAngle(c)self._angle=tonumber(c)return self end;function A:alpha()return self._alpha end;function A:setAlpha(c)self._alpha=tonumber(c)return self end;function A:anchorX()return self._anchorX end;function A:setAnchorX(c)self._anchorX=tonumber(c)return self end;function A:anchorY()return self._anchorY end;function A:setAnchorY(c)self._anchorY=tonumber(c)return self end;function A:render()if self:isRendered()then self:unrender()end;local h=self:inheritTarget()local B=self:inheritFixedPos()self._renderedId=tfm.exec.addImage(self._source,(B and'&'or'!')..tostring(1),self:globalX(),self:globalY(),h,self._scaleX,self._scaleY,self._angle,self._alpha,self._anchorX,self._anchorY)self:renderChildren()end;function A:unrender()if not self:isRendered()then return end;tfm.exec.removeImage(self._renderedId)self._renderedId=-1;self:unrenderChildren()end end
